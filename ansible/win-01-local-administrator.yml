- name: Add local and domain users via WinRM
  hosts: all
  gather_facts: no
  vars:
    ansible_user: ASDF\admin
    ansible_password: X5959xfveS!8*fUY*NrF2Vcv^RxnM@GHq$
    ansible_connection: winrm
    ansible_winrm_transport: ntlm
    ansible_winrm_server_cert_validation: ignore
  tasks:
    - name: Wait for connection
      wait_for_connection:
        timeout: 300
    - name: Add local administrator
      win_user:
        name: Utmost1428
        password: v_T3W3isnQuqv
        state: present
        groups: Administrators
    - name: Ensure user bob is present in OU ou=test,dc=domain,dc=local
      community.windows.win_domain_user:
        name: bob
        password: B0bP4ssw0rd
        state: present
        domain_server: asdf.co.nz
        groups:
          - Domain Admins